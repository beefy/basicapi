import pytest\nimport asyncio\nfrom httpx import AsyncClient\nfrom app.main import app\nfrom app.db.mongodb import connect_to_mongo, close_mongo_connection\nfrom motor.motor_asyncio import AsyncIOMotorClient\nfrom app.core.config import settings\n\n\n@pytest.fixture(scope=\"session\")\ndef event_loop():\n    \"\"\"Create an instance of the default event loop for the test session.\"\"\"\n    loop = asyncio.get_event_loop_policy().new_event_loop()\n    yield loop\n    loop.close()\n\n\n@pytest.fixture(scope=\"session\")\nasync def setup_test_db():\n    \"\"\"Setup test database\"\"\"\n    # Use a test database\n    original_db = settings.database_name\n    settings.database_name = \"basicapi_test\"\n    \n    # Connect to test database\n    await connect_to_mongo()\n    \n    yield\n    \n    # Cleanup: Drop test database and close connection\n    client = AsyncIOMotorClient(settings.mongodb_url)\n    await client.drop_database(\"basicapi_test\")\n    await close_mongo_connection()\n    \n    # Restore original database name\n    settings.database_name = original_db\n\n\n@pytest.fixture\nasync def client(setup_test_db):\n    \"\"\"Create test client\"\"\"\n    async with AsyncClient(app=app, base_url=\"http://test\") as ac:\n        yield ac\n\n\n@pytest.fixture\nasync def auth_headers(client):\n    \"\"\"Get authentication headers\"\"\"\n    # Login to get token\n    response = await client.post(\n        \"/api/v1/auth/token\",\n        auth=(\"admin\", \"secret\")\n    )\n    assert response.status_code == 200\n    token = response.json()[\"access_token\"]\n    return {\"Authorization\": f\"Bearer {token}\"}\n