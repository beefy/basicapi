from fastapi import Depends, HTTPException, status\nfrom fastapi.security import HTTPBearer, HTTPAuthorizationCredentials\nfrom ..core.security import verify_token\nfrom ..models.schemas import User\nfrom typing import Optional\n\n\nsecurity = HTTPBearer()\n\n\n# For demo purposes, we'll use a simple in-memory user store\n# In production, this should be in a proper database\nfake_users_db = {\n    \"admin\": {\n        \"username\": \"admin\",\n        \"full_name\": \"Admin User\",\n        \"email\": \"admin@example.com\",\n        \"hashed_password\": \"$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW\",  # \"secret\"\n        \"disabled\": False,\n    }\n}\n\n\ndef get_user(username: str) -> Optional[User]:\n    if username in fake_users_db:\n        user_dict = fake_users_db[username]\n        return User(**user_dict)\n    return None\n\n\nasync def get_current_user(\n    credentials: HTTPAuthorizationCredentials = Depends(security)\n) -> User:\n    credentials_exception = HTTPException(\n        status_code=status.HTTP_401_UNAUTHORIZED,\n        detail=\"Could not validate credentials\",\n        headers={\"WWW-Authenticate\": \"Bearer\"},\n    )\n    \n    token = credentials.credentials\n    username = verify_token(token)\n    \n    if username is None:\n        raise credentials_exception\n        \n    user = get_user(username=username)\n    if user is None:\n        raise credentials_exception\n        \n    return user\n\n\nasync def get_current_active_user(current_user: User = Depends(get_current_user)):\n    if current_user.disabled:\n        raise HTTPException(status_code=400, detail=\"Inactive user\")\n    return current_user\n